{% extends "admin_dashboard.html" %}
{% block content %}
<style>
        
        .container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin-top: 30px;
        }
        .card {
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px 8px 0 0;
            padding: 15px 20px;
            font-weight: bold;
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-weight: bold;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 5px;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }
        .student-card {
            border-left: 5px solid #667eea;
            margin-bottom: 15px;
        }
        .student-name {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        .subject-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        .subject-item {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 10px;
            border-radius: 20px;
            margin-right: 5px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        .subject-item.remove-btn {
            cursor: pointer;
            background: #ffebee;
            color: #c62828;
        }
        .subject-item.remove-btn:hover {
            background: #ffcdd2;
        }
        .add-subject-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .add-subject-btn:hover {
            background: #45a049;
        }
        .table-responsive {
            margin-top: 20px;
        }
        .back-link {
            margin-top: 20px;
            text-align: center;
        }
        .back-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
    </style>

    <div class="container">
        

        <h1>üë• Manage Student Subjects</h1>

        {% if message %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert">&times;</button>
            </div>
        {% endif %}

        <div class="card">
            <div class="card-header">
                {% if class_name %}
                    {{ class_name }} - Subject Enrollment Details
                {% else %}
                    Subject Enrollment Management
                {% endif %}
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="form-group">
                        <label for="class_select">Select a Class:</label>
                        <select class="form-control" id="class_select" name="class_select" required onchange="this.form.submit()">
                            <option value="">-- Choose a Class to View Students --</option>
                            {% for class_id, class_name_opt in class_options.items() %}
                                <option value="{{ class_id }}" {% if selected_class == class_id %}selected{% endif %}>
                                    {{ class_name_opt }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                </form>

                {% if selected_class %}
                    {% if students %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Admission No.</th>
                                        <th>Student Name</th>
                                        <th>Enrolled Subjects</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for student in students %}
                                        <tr class="student-card">
                                            <td><code>{{ student.admission_no }}</code></td>
                                            <td class="student-name">{{ student.first_name }} {{ student.last_name }}</td>
                                            <td>
                                                {% if student.subjects %}
                                                    <div class="subject-list">
                                                        {% for subject in student.subjects %}
                                                            <span class="subject-item">{{ subject }}</span>
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    <span class="badge badge-warning">No subjects enrolled</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <form method="POST" action="{{ url_for('edit_student_subjects') }}" style="display:inline;">
                                                    <input type="hidden" name="admission_no" value="{{ student.admission_no }}">
                                                    <input type="hidden" name="class_id" value="{{ class_id }}">
                                                    <button type="submit" class="btn btn-sm btn-info">Edit</button>
                                                </form>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle"></i> No students found in this class.
                        </div>
                    {% endif %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Select a class from the dropdown above to view students and manage their subject enrollments.
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="back-link">
            <a href="{{ url_for('enroll_class_subjects') }}">‚Üê Back to Subject Enrollment</a>
        </div>
    </div>

    
{% endblock %}
